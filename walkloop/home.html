<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk Loop</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="./images/favicon.ico" type="image/x-icon">
</head>

<body>
    <header class="bg-primary text-white text-center py-3">
        <h1>Walk Loop</h1>
    </header>
    <div class="container mt-5">
        <form id="walkForm">
            <div class="form-group">
                <label for="startPoint">Start Point</label>
                <input type="text" class="form-control" id="startPoint" placeholder="Enter starting point">
            </div>
            <!-- <div class="form-group">
                <label for="endPoint">End Point</label>
                <input type="text" class="form-control" id="endPoint" placeholder="Enter ending point (optional)">
            </div> -->
            <div class="form-group">
                <label for="duration">Desired Duration (minutes)</label>
                <!-- <input type="number" class="form-control" id="duration" placeholder="Enter duration in minutes"> -->
            </div>
            <button onclick="createWalkingRoute()" type="submit" class="btn btn-primary">Generate Route</button>
        </form>
        <div id="map" style="height: 300px; width: 100%;"></div>
        <script>
            let map;
            let directionsService;
            let directionsRenderer;
            let autocomplete;

            // Initialize the map
            function initMap() {
              map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 0, lng: 0 }, // Default center, will update based on input
                zoom: 14
              });
        
              directionsService = new google.maps.DirectionsService();
              directionsRenderer = new google.maps.DirectionsRenderer({
                map: map
              });
            }

            // Initialize Autocomplete for the input field
            const input = document.getElementById('startPoint');
            autocomplete = new google.maps.places.Autocomplete(input);

            // Bias the autocomplete predictions to the current map viewport
            autocomplete.setBounds(map.getBounds());
            // Function to create a walking route
            function createWalkingRoute() {
              const startPoint = document.getElementById('startPoint').value;
              if (!startPoint) {
                alert('Please enter a starting point');
                return;
              }
        
              // Geocode the starting point address to get lat/lng
              const geocoder = new google.maps.Geocoder();
              geocoder.geocode({ address: startPoint }, (results, status) => {
                if (status === google.maps.GeocoderStatus.OK) {
                  const origin = results[0].geometry.location;
                  
                  // Use Directions API to create a walking route
                  const request = {
                    origin: origin,
                    destination: origin,  // Start and end at the same point
                    travelMode: google.maps.TravelMode.WALKING,
                    waypoints: [],  // No intermediate waypoints for a simple loop
                    optimizeWaypoints: false,
                    unitSystem: google.maps.UnitSystem.METRIC,
                    provideRouteAlternatives: true
                  };
        
                  // Request the route
                  directionsService.route(request, (response, status) => {
                    if (status === google.maps.DirectionsStatus.OK) {
                      // Render the route
                      directionsRenderer.setDirections(response);
        
                      // Calculate total duration and adjust the route if necessary
                      const routeDuration = response.routes[0].legs[0].duration.value / 60; // in minutes
                      if (routeDuration < 20) {
                        alert("The route is shorter than 20 minutes. You may need to modify the route manually.");
                      } else if (routeDuration > 20) {
                        alert("The route is longer than 20 minutes. Consider adjusting your parameters.");
                      }
                    } else {
                      alert('Directions request failed due to ' + status);
                    }
                  });
                } else {
                  alert('Geocode was not successful for the following reason: ' + status);
                }
              });
            }
        
            // Load the map on page load
            window.onload = initMap;
          </script>

    </div>
    <!-- fetch latest commit time -->
</div>
    <div class="container mt-5">
        <h2>Latest Commit Time</h2>
        <p id="commitTime">Fetching...</p>
    <script>
        async function fetchLatestCommitTime() {
            try {
                const response = await fetch('https://api.github.com/repos/nomadpixel-25/landing/commits');
                const data = await response.json();
                const latestCommit = data[0];
                const commitTime = new Date(latestCommit.commit.author.date).toLocaleString('en-GB', {
                    timeZone: 'Europe/London',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('commitTime').innerText = commitTime;
            } catch (error) {
                document.getElementById('commitTime').innerText = 'Error fetching commit time';
            }
        }

        fetchLatestCommitTime();
    </script>

    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCec2M2PampMVbG14FthTZUcYPHZItmv5c&libraries=places&callback=initMap" defer></script>

    <footer class="bg-primary text-white text-center py-3 mt-5">
        <p>Version: <span id="version"></span></p>
        <script>
            document.getElementById('version').textContent = new Date().toLocaleString();
        </script>
          
        <p>&copy; 2025 Walk Loop</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
</body>
</html></html>